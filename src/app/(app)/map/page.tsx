import { headers } from "next/headers";
import { getDb, query } from "@/lib/db";
import LockedContent from "@/components/ui/LockedContent";
import InteractiveMap from "@/components/map/InteractiveMap";
import type { Metadata } from "next";

export const metadata: Metadata = { title: "インシデントマップ - 海蝕機関" };

async function loadMapData() {
  try {
    const db = getDb();
    const rows = await query<{ id: string; data: string }>(db,
      "SELECT id, data FROM map_incidents ORDER BY rowid ASC"
    ).catch(() => []);
    if (rows.length > 0) {
      const incidents = rows
        .map(r => { try { return JSON.parse(r.data) as Incident; } catch { return null; } })
        .filter(Boolean) as Incident[];
      return { incidents, statistics: calcStats(incidents) };
    }
  } catch { /* fall through */ }
  try {
    const { default: data } = await import("../../../../public/data/map-incidents.json");
    return data as { incidents: Incident[]; statistics: Statistics };
  } catch {
    return { incidents: [], statistics: { total: 0, critical: 0, warning: 0, safe: 0 } };
  }
}

function calcStats(incidents: Incident[]): Statistics {
  return {
    total:    incidents.length,
    critical: incidents.filter(i => i.severity === "critical").length,
    warning:  incidents.filter(i => i.severity === "warning").length,
    safe:     incidents.filter(i => i.severity === "safe").length,
  };
}

interface Incident {
  id: string; name: string; severity: "critical" | "warning" | "safe";
  position: { x: number; y: number };
  location: string; status: string; entity: string; gsi: string;
  assignedDivision: string; description: string; timestamp: string;
}
interface Statistics { total: number; critical: number; warning: number; safe: number; }

// ── GeoJSON (N03-20250101_44.geojson) を
//    中心(131.4°E,33.23°N)・km換算・123°回転・SVG 860x680 PAD40 で投影したパスデータ
const GEO_PATHS: { code: string; name: string; color: string; stroke: string; paths: string[] }[] = [
  { code: "44201", name: "大分市", color: "#0d2218", stroke: "#00d4b4", paths: ["M454.14,475.06 L444.07,484.35 L438.09,486.94 L435.68,482.01 L434.07,482.63 L435.95,487.46 L426.18,491.15 L423.54,489.13 L419.56,492.37 L421.39,494.19 L416.89,495.72 L415.82,492.19 L410.60,496.11 L412.38,494.82 L418.08,498.58 L414.71,503.70 L408.86,504.14 L412.34,507.50 L411.55,509.55 L408.41,508.12 L407.28,502.15 L408.17,507.68 L397.82,517.78 L391.19,535.46 L392.59,537.23 L390.55,544.85 L384.83,546.78 L382.09,550.73 L389.28,551.20 L387.17,565.09 L383.64,569.54 L380.75,568.46 L378.10,560.13 L374.79,557.07 L379.07,549.61 L377.40,550.47 L374.28,543.57 L370.89,545.14 L367.85,542.97 L362.20,529.17 L358.28,532.07 L356.34,526.25 L358.57,524.78 L357.32,518.10 L370.21,520.28 L374.01,501.98 L372.86,496.16 L375.90,494.05 L376.16,486.54 L380.64,474.87 L378.63,466.58 L383.32,464.58 L382.41,459.01 L377.11,449.00 L371.66,449.41 L367.14,441.13 L362.29,440.49 L357.38,432.35 L354.55,432.60 L354.06,429.00 L350.17,428.79 L347.68,421.00 L339.50,415.72 L342.41,410.80 L352.40,408.20 L358.74,402.35 L357.04,395.73 L359.69,391.05 L363.17,391.47 L381.29,381.14 L384.77,375.68 L384.05,371.40 L388.49,367.85 L396.44,367.31 L399.08,363.24 L405.64,364.69 L407.29,358.01 L405.24,354.62 L405.69,343.78 L408.95,336.25 L407.43,329.05 L403.02,329.60 L399.43,322.99 L400.94,317.84 L404.43,318.47 L401.66,314.97 L405.94,307.69 L414.55,307.81 L421.70,312.69 L423.35,306.29 L421.18,297.10 L423.30,291.25 L431.73,295.87 L431.61,301.72 L434.56,307.08 L437.59,307.23 L439.78,311.12 L443.52,309.83 L447.43,312.69 L449.36,323.12 L446.90,327.30 L443.32,328.21 L447.22,331.78 L444.58,334.16 L446.65,340.01 L445.61,349.46 L449.83,353.32 L445.07,357.29 L453.30,372.93 L451.15,381.10 L453.45,381.22 L452.98,383.54 L457.08,383.59 L457.56,387.53 L464.29,389.11 L465.57,392.82 L472.32,396.93 L470.06,399.45 L474.98,400.69 L484.15,393.20 L493.13,398.11 L490.74,401.52 L482.81,404.93 L479.82,410.85 L466.45,419.76 L466.18,423.41 L465.94,421.08 L462.12,423.00 L461.49,425.59 L465.71,424.09 L463.38,426.36 L465.00,430.05 L460.65,429.89 L460.89,434.08 L462.48,431.08 L465.05,431.16 L463.63,439.75 L459.79,443.41 L461.82,445.11 L456.79,463.15 L458.77,464.93 L445.96,462.57 L445.90,464.84 L455.64,468.46 L457.84,467.13 L455.07,468.42 L454.84,473.48 L448.02,470.74 L445.46,472.58 L454.14,475.06 Z", "M374.25,597.34 L372.14,596.06 L372.05,594.36 L372.84,594.15 L372.60,593.23 L373.43,592.52 L372.78,589.62 L373.85,589.26 L374.62,589.70 L375.71,588.89 L377.85,589.34 L378.67,588.14 L378.36,589.81 L375.66,593.82 L375.82,594.92 L374.51,595.64 L374.25,597.34 Z", "M371.14,555.76 L370.03,556.21 L368.67,555.34 L368.93,553.94 L370.03,554.46 L371.16,552.84 L371.14,555.76 Z"] },
  { code: "44202", name: "別府市", color: "#0a1a28", stroke: "#00b8e0", paths: ["M553.19,408.09 L549.23,412.34 L548.26,410.05 L548.91,413.48 L545.35,415.56 L544.26,418.11 L531.72,409.48 L527.54,410.85 L526.73,408.77 L520.76,407.50 L514.51,402.92 L514.51,404.87 L513.94,403.00 L509.34,400.27 L507.45,400.97 L508.96,400.71 L498.00,396.63 L493.13,398.11 L487.64,393.60 L483.26,393.76 L484.51,391.01 L488.24,389.93 L489.59,386.21 L482.01,383.52 L475.18,378.44 L481.79,374.53 L483.25,372.86 L482.19,369.56 L485.69,366.96 L493.06,364.01 L496.72,365.21 L498.51,363.73 L498.68,359.12 L496.22,358.32 L497.64,353.56 L501.82,354.22 L502.96,351.95 L505.46,334.29 L515.15,326.61 L517.29,326.27 L523.72,330.18 L528.20,342.67 L530.89,344.50 L534.13,344.11 L537.70,346.82 L534.30,354.15 L534.60,363.71 L537.91,364.52 L541.09,367.58 L543.48,371.02 L545.35,379.12 L548.17,381.09 L551.30,378.98 L552.99,375.66 L552.11,369.69 L557.57,365.35 L564.14,368.00 L567.65,373.97 L571.47,375.17 L570.50,378.51 L566.86,382.00 L562.70,381.51 L559.32,388.72 L558.77,387.30 L557.70,391.82 L559.63,391.70 L559.46,393.35 L556.25,396.70 L553.19,408.09 Z"] },
  { code: "44203", name: "中津市", color: "#0d2018", stroke: "#00caa8", paths: ["M774.62,375.45 L766.53,382.10 L761.93,382.87 L760.68,380.31 L759.22,383.98 L753.17,387.52 L751.46,389.87 L755.55,392.67 L756.97,397.74 L753.95,392.02 L754.59,397.04 L750.29,398.31 L752.95,400.63 L752.03,402.30 L754.74,402.21 L746.90,399.58 L745.34,396.74 L738.45,400.04 L736.82,398.34 L729.07,400.78 L716.60,389.21 L720.08,383.13 L712.74,373.44 L687.40,370.09 L681.48,357.66 L684.84,347.98 L681.77,348.10 L678.06,343.64 L671.79,343.58 L667.73,339.09 L655.84,337.67 L646.92,332.56 L646.87,329.06 L650.84,327.28 L654.39,319.61 L646.38,315.85 L642.58,308.32 L634.77,309.22 L630.95,298.04 L632.68,292.21 L629.14,285.01 L635.78,284.06 L637.65,278.28 L649.30,278.99 L649.82,271.47 L660.20,272.36 L664.17,268.44 L659.81,260.86 L664.46,256.86 L666.59,259.13 L679.00,254.75 L685.21,239.35 L676.33,226.72 L684.27,211.80 L693.46,214.89 L700.39,212.59 L701.64,215.26 L707.04,216.34 L715.72,211.02 L723.63,211.42 L734.85,207.56 L739.47,209.64 L746.84,202.69 L754.61,205.36 L761.71,201.30 L765.28,202.08 L769.08,206.77 L775.49,218.87 L774.18,230.10 L777.25,239.22 L772.56,254.16 L766.93,259.27 L765.96,265.14 L768.00,268.94 L766.32,271.77 L759.13,272.35 L753.06,281.65 L747.54,284.71 L743.50,293.35 L740.36,295.00 L739.59,299.65 L730.51,306.62 L731.12,310.55 L719.29,330.38 L726.12,329.21 L733.45,332.69 L736.06,347.33 L743.24,354.31 L757.41,352.90 L763.79,356.40 L771.93,365.96 L775.86,373.84 L772.89,372.70 L775.57,373.97 L774.62,375.45 Z"] },
  { code: "44204", name: "日田市", color: "#122818", stroke: "#00c098", paths: ["M764.81,202.14 L761.71,201.30 L754.49,205.37 L746.96,202.65 L740.55,209.29 L734.85,207.56 L723.63,211.42 L715.72,211.02 L707.04,216.34 L701.64,215.26 L700.39,212.59 L693.46,214.89 L684.27,211.80 L673.68,228.92 L663.32,217.48 L659.55,224.80 L655.89,220.64 L653.55,222.74 L651.75,221.62 L655.18,218.77 L651.92,209.98 L647.52,208.46 L644.18,195.85 L637.54,190.18 L636.11,192.32 L633.47,189.83 L634.50,184.74 L629.81,186.31 L626.79,184.68 L625.64,190.32 L622.76,192.11 L625.14,194.73 L621.80,199.07 L612.46,195.13 L608.29,198.37 L601.34,199.21 L600.03,195.90 L590.21,190.75 L578.01,178.59 L587.72,171.04 L592.53,162.95 L591.13,145.23 L600.83,136.75 L597.76,135.51 L598.02,132.95 L590.15,123.49 L581.52,119.36 L582.47,116.16 L571.64,119.38 L567.11,115.75 L556.53,118.62 L541.04,118.06 L536.06,106.47 L530.21,107.06 L526.75,101.59 L522.59,100.09 L516.91,81.21 L522.72,72.27 L532.18,71.74 L538.93,74.43 L544.88,71.88 L554.14,58.38 L562.06,58.58 L565.83,54.22 L569.92,56.62 L573.20,54.87 L580.67,56.92 L585.76,54.27 L587.61,49.53 L591.41,49.51 L594.82,40.62 L600.79,40.76 L603.27,42.58 L601.63,49.81 L603.67,56.39 L606.34,56.74 L607.29,61.63 L616.46,70.41 L617.28,76.57 L627.21,79.20 L629.08,83.18 L627.88,87.28 L632.77,91.58 L643.11,83.28 L660.23,77.27 L664.29,85.20 L662.05,92.01 L663.66,93.94 L677.04,81.74 L686.27,86.85 L687.31,89.94 L682.69,96.92 L679.49,109.66 L681.76,110.77 L683.06,107.29 L691.18,107.19 L694.83,118.55 L714.88,123.97 L715.87,126.51 L723.79,126.73 L725.65,125.13 L723.18,122.87 L731.01,122.51 L733.18,140.18 L740.81,146.10 L735.93,152.95 L735.49,157.56 L747.27,165.42 L748.07,169.30 L759.66,176.23 L763.57,182.92 L768.24,184.23 L764.81,202.14 Z"] },
  { code: "44205", name: "佐伯市", color: "#0a1a14", stroke: "#00bc90", paths: ["M248.16,544.75 L243.89,544.45 L240.18,549.13 L245.61,533.68 L243.73,528.80 L249.33,521.21 L253.23,519.73 L254.32,515.64 L258.53,514.05 L257.45,509.37 L261.51,508.86 L261.77,506.22 L258.04,503.57 L259.57,500.41 L249.89,495.37 L247.57,480.18 L239.72,479.55 L237.84,474.18 L245.84,477.55 L240.99,473.15 L241.79,469.17 L238.40,469.17 L237.68,471.77 L232.99,467.91 L231.13,472.51 L229.71,469.84 L226.63,472.34 L227.81,473.89 L221.93,473.16 L224.58,476.00 L221.29,479.78 L217.01,474.64 L212.08,478.86 L206.19,476.69 L206.71,484.01 L196.52,483.89 L196.73,487.28 L197.68,485.63 L204.10,489.48 L197.83,490.47 L201.61,497.00 L193.49,489.65 L191.59,492.82 L190.39,490.15 L186.62,491.80 L187.26,498.61 L192.33,500.13 L190.03,502.54 L190.98,507.83 L181.99,497.94 L177.03,498.58 L177.78,501.42 L174.95,502.26 L175.56,510.07 L171.91,514.79 L179.80,519.43 L173.02,521.84 L171.97,525.22 L174.62,527.17 L168.12,527.67 L165.30,531.25 L166.25,534.06 L160.06,537.36 L153.24,533.88 L155.41,530.68 L160.58,529.13 L160.75,526.05 L166.26,523.88 L164.90,521.58 L166.94,520.10 L163.21,519.04 L161.70,514.98 L164.58,512.94 L168.78,515.33 L172.00,509.87 L170.38,507.50 L171.89,503.79 L168.14,501.93 L171.56,498.58 L161.00,492.46 L168.08,488.33 L173.44,490.93 L176.47,489.88 L174.69,486.95 L179.29,483.41 L173.89,484.58 L159.08,476.37 L157.52,479.85 L161.82,484.04 L155.35,484.73 L151.39,489.90 L152.90,481.68 L149.06,479.16 L148.83,469.96 L145.42,466.48 L151.02,463.71 L144.96,460.35 L143.61,450.81 L150.77,450.34 L151.37,448.33 L142.00,446.51 L143.81,438.82 L141.63,438.90 L139.36,445.64 L128.41,441.66 L128.67,445.06 L138.70,448.92 L130.18,449.57 L129.28,451.63 L127.44,450.33 L126.93,455.57 L128.76,457.09 L136.44,455.11 L137.18,458.29 L138.78,456.17 L136.28,461.45 L123.00,468.24 L119.56,464.40 L118.84,442.15 L111.98,439.81 L111.60,436.51 L115.32,433.43 L119.26,435.18 L117.48,436.96 L120.98,437.47 L125.32,434.02 L126.16,430.08 L120.86,427.88 L117.74,418.31 L120.14,415.47 L124.73,417.03 L126.97,415.07 L126.94,418.08 L129.82,419.00 L129.58,413.86 L122.90,411.25 L131.14,408.55 L127.99,402.99 L132.04,401.10 L133.29,405.58 L135.60,404.30 L137.80,407.98 L138.39,405.24 L140.77,406.89 L141.95,404.54 L136.16,397.61 L126.55,399.03 L124.57,394.83 L118.73,393.45 L120.04,392.02 L137.71,395.46 L137.64,391.22 L131.77,389.38 L132.25,384.75 L124.05,386.58 L118.38,378.07 L114.65,383.49 L111.99,382.49 L117.83,361.84 L124.87,364.59 L131.33,372.14 L140.21,374.61 L151.23,391.77 L159.74,396.49 L161.71,395.54 L160.92,390.43 L165.82,385.12 L174.14,384.17 L175.13,373.62 L179.03,370.79 L178.69,367.90 L186.80,368.98 L195.52,361.75 L200.29,345.26 L185.47,331.70 L183.20,321.66 L176.28,313.95 L181.99,308.09 L185.36,293.42 L202.38,276.53 L207.82,265.31 L211.95,262.58 L207.65,244.57 L219.24,232.09 L232.90,224.83 L240.73,228.48 L247.06,238.09 L256.79,234.54 L258.73,236.22 L262.08,232.53 L267.15,231.31 L278.60,231.94 L277.50,235.44 L280.20,244.75 L274.75,259.62 L278.42,285.96 L268.14,297.65 L274.65,301.82 L272.31,303.39 L272.01,309.72 L276.83,313.79 L277.47,317.30 L285.05,320.37 L283.83,324.53 L278.08,325.07 L277.42,328.02 L280.84,330.89 L284.34,326.59 L286.64,327.82 L289.17,336.02 L285.84,339.83 L291.59,349.15 L290.92,355.69 L284.09,356.09 L279.76,362.48 L281.23,377.85 L270.44,400.46 L266.03,402.09 L266.87,414.22 L265.10,416.63 L274.26,417.93 L280.44,421.71 L283.61,430.36 L287.41,432.95 L287.56,437.73 L292.04,438.93 L292.06,441.04 L284.54,449.84 L280.33,451.55 L282.31,460.73 L275.81,475.49 L267.56,485.92 L270.40,497.28 L266.18,514.42 L260.37,516.79 L258.57,522.90 L249.94,526.81 L250.42,544.92 L248.16,544.75 Z", "M240.83,497.39 L238.55,501.00 L236.80,500.22 L237.40,499.42 L236.07,497.88 L238.24,497.01 L236.18,495.55 L236.06,493.36 L234.99,493.25 L234.43,488.26 L233.23,486.74 L232.30,490.40 L231.23,491.27 L231.76,491.79 L230.49,491.73 L230.31,493.77 L228.41,493.88 L227.57,494.93 L226.36,494.02 L226.82,492.97 L227.22,494.13 L228.07,492.30 L226.97,491.74 L226.80,492.61 L228.20,490.35 L227.39,487.23 L228.08,488.11 L228.43,486.60 L227.72,485.91 L227.61,486.96 L227.28,482.90 L224.86,480.12 L227.09,478.60 L226.43,479.61 L227.53,479.55 L228.08,476.55 L231.71,475.66 L230.84,476.18 L232.37,476.45 L232.08,477.38 L233.08,476.53 L234.41,478.02 L235.20,479.68 L234.67,481.32 L236.02,481.29 L236.01,482.66 L234.22,483.01 L235.42,484.32 L235.31,487.16 L238.90,489.45 L239.62,485.24 L240.33,488.02 L241.27,487.39 L243.64,489.32 L241.94,490.88 L241.04,490.41 L241.08,492.04 L242.45,491.23 L242.86,492.08 L242.69,495.25 L240.83,497.39 Z", "M180.20,546.02 L178.02,545.92 L176.94,547.27 L176.24,545.92 L174.78,546.46 L174.35,544.09 L172.30,543.25 L171.77,543.93 L171.46,542.85 L169.34,542.70 L169.20,542.16 L170.52,542.26 L171.05,541.53 L169.59,539.77 L170.14,538.27 L169.03,537.12 L167.72,536.96 L167.73,536.41 L168.55,535.84 L169.18,536.64 L170.11,536.17 L171.32,536.86 L172.58,536.14 L174.02,536.49 L174.21,537.13 L175.27,536.98 L174.49,537.22 L174.79,537.55 L177.30,534.86 L175.66,537.41 L175.39,541.44 L175.92,542.11 L175.78,541.11 L176.40,542.42 L175.79,542.41 L176.03,542.78 L176.75,542.45 L176.51,541.92 L177.59,542.79 L177.78,543.73 L177.57,543.16 L176.96,543.61 L178.21,544.26 L178.00,545.39 L180.20,546.02 Z", "M123.70,404.58 L121.76,404.96 L120.46,406.37 L119.47,406.34 L118.62,407.12 L119.09,407.80 L117.61,407.95 L116.73,409.17 L115.50,409.20 L113.82,407.64 L115.05,405.63 L115.12,404.14 L116.93,402.63 L117.14,401.44 L119.05,400.87 L120.00,401.57 L119.54,402.55 L120.36,403.83 L121.77,404.58 L123.70,404.58 Z", "M90.03,394.25 L89.27,395.15 L88.18,394.92 L87.38,394.22 L87.65,393.35 L86.03,394.24 L85.49,393.69 L84.71,394.55 L84.41,393.65 L85.31,392.52 L84.67,391.75 L84.02,392.03 L84.46,390.94 L83.61,391.33 L83.71,389.45 L85.12,388.84 L85.62,388.87 L85.53,389.47 L86.26,388.73 L86.98,389.68 L87.89,389.27 L88.42,392.90 L89.59,391.66 L91.43,391.29 L90.03,394.25 Z", "M210.82,491.64 L210.10,492.25 L209.67,490.53 L207.16,489.83 L208.43,488.02 L208.85,488.79 L209.71,489.21 L210.67,488.83 L211.93,489.80 L210.95,490.37 L210.82,491.64 Z", "M246.97,486.69 L246.28,486.62 L245.46,484.88 L244.04,485.12 L242.72,483.47 L244.35,484.27 L246.67,483.99 L246.97,486.69 Z", "M158.06,513.47 L156.65,513.07 L155.29,513.69 L153.85,512.82 L155.46,511.93 L156.58,512.79 L158.13,512.75 L158.06,513.47 Z", "M141.43,494.33 L140.10,494.87 L139.87,493.45 L140.58,492.36 L141.95,492.74 L141.43,494.33 Z", "M182.51,546.23 L181.24,546.69 L181.06,546.28 L182.76,544.90 L182.51,546.23 Z"] },
  { code: "44206", name: "臼杵市", color: "#0d2418", stroke: "#00c8a0", paths: ["M369.00,520.58 L356.91,518.43 L358.92,514.07 L357.87,508.85 L355.11,507.76 L352.66,499.45 L348.88,495.50 L345.73,496.44 L348.54,500.24 L342.61,496.19 L342.51,486.04 L338.14,480.09 L339.59,477.28 L337.65,474.94 L334.99,481.55 L332.86,477.63 L331.74,479.57 L334.57,482.32 L331.99,480.75 L327.96,485.05 L329.39,489.26 L325.65,491.66 L323.88,488.44 L319.38,490.48 L318.86,498.35 L321.38,503.27 L318.35,504.76 L320.81,508.07 L318.10,511.40 L314.43,507.63 L311.90,510.87 L314.15,514.08 L310.60,515.90 L314.77,522.30 L309.61,520.62 L305.03,524.10 L307.56,517.71 L306.71,512.22 L311.24,503.60 L311.01,490.37 L316.57,480.66 L313.70,476.31 L317.21,466.62 L314.60,459.27 L314.95,449.20 L305.12,446.23 L298.20,453.83 L299.82,449.44 L294.39,440.34 L287.56,437.73 L287.41,432.95 L283.61,430.36 L280.44,421.71 L274.26,417.93 L265.10,416.63 L266.87,414.22 L266.03,402.09 L270.36,400.57 L273.09,391.92 L279.78,383.15 L279.76,362.48 L284.09,356.09 L290.78,355.78 L291.70,358.16 L301.02,361.60 L306.14,360.53 L317.09,363.16 L322.26,359.63 L324.09,362.35 L328.02,360.69 L327.34,363.06 L336.87,370.33 L331.89,374.51 L331.61,382.01 L337.02,386.74 L345.17,384.24 L345.29,387.25 L350.00,390.95 L348.93,393.60 L353.06,397.24 L352.12,406.78 L342.30,410.87 L339.48,417.09 L347.68,421.00 L350.17,428.79 L354.06,429.00 L354.55,432.60 L357.38,432.35 L362.29,440.49 L367.14,441.13 L371.66,449.41 L377.11,449.00 L383.32,464.58 L378.63,466.58 L380.64,474.87 L376.16,486.54 L375.90,494.05 L372.86,496.16 L372.29,514.13 L369.00,520.58 Z", "M329.93,508.27 L328.92,509.18 L328.06,508.43 L328.04,505.75 L329.24,505.35 L330.15,505.89 L329.93,508.27 Z", "M355.25,509.59 L354.36,510.38 L353.39,510.08 L353.09,509.20 L355.24,508.63 L355.66,509.12 L355.25,509.59 Z"] },
  { code: "44207", name: "津久見市", color: "#0a1c14", stroke: "#00bc90", paths: ["M306.45,525.32 L304.48,526.21 L303.48,524.88 L304.87,515.19 L300.59,514.54 L301.08,510.12 L303.77,507.25 L305.46,507.70 L306.15,505.02 L304.71,501.32 L302.81,503.18 L302.59,495.32 L299.31,493.71 L300.84,492.99 L300.35,490.82 L302.45,490.41 L303.18,485.74 L299.64,486.38 L295.89,490.79 L297.52,487.72 L295.37,484.63 L292.77,487.62 L293.96,488.20 L292.15,488.30 L291.46,492.01 L285.20,494.95 L285.54,497.04 L289.23,494.72 L289.74,496.42 L291.68,496.65 L291.51,498.58 L284.70,500.23 L281.90,502.93 L283.36,509.12 L277.60,507.67 L276.08,504.59 L274.97,504.91 L275.80,504.11 L272.95,507.10 L274.21,506.64 L274.41,509.56 L271.63,508.69 L270.18,509.93 L270.48,512.94 L275.08,512.31 L275.16,514.97 L273.38,514.67 L272.59,516.33 L276.53,520.31 L282.82,520.58 L282.06,527.65 L280.88,527.72 L280.99,524.86 L279.00,522.70 L274.84,520.67 L273.37,522.92 L271.65,519.97 L268.84,520.84 L266.94,519.14 L262.20,522.60 L263.65,524.57 L264.91,523.78 L262.32,530.84 L260.68,531.52 L258.17,527.92 L254.59,528.87 L254.14,530.77 L256.26,532.92 L253.96,534.44 L253.12,539.15 L256.02,541.02 L260.10,541.06 L262.55,545.44 L264.33,544.63 L265.43,546.76 L263.87,549.14 L264.66,554.31 L257.87,546.31 L253.89,547.49 L250.06,545.95 L251.19,537.11 L249.36,535.51 L249.94,526.81 L258.57,522.90 L260.37,516.79 L262.78,517.27 L266.00,514.90 L267.27,503.83 L270.40,497.28 L267.56,485.92 L270.71,479.66 L275.81,475.49 L279.98,462.67 L282.31,460.73 L280.33,451.55 L284.54,449.84 L285.21,447.12 L290.81,442.76 L292.42,439.30 L295.73,442.19 L296.58,446.85 L299.82,449.44 L298.27,453.87 L300.42,453.18 L305.12,446.23 L314.17,448.61 L315.88,452.37 L314.60,459.27 L317.21,466.62 L315.28,468.38 L315.82,472.52 L313.70,476.31 L316.55,478.17 L316.57,480.66 L310.14,493.93 L311.24,503.60 L306.71,512.22 L307.56,517.71 L305.00,524.00 L306.45,525.32 Z", "M269.63,563.75 L267.84,563.05 L265.48,564.63 L264.32,562.61 L264.02,559.92 L264.60,557.61 L263.82,556.42 L264.13,555.57 L264.87,555.60 L264.75,557.66 L265.19,555.47 L265.40,558.25 L267.17,558.58 L266.98,559.61 L268.24,558.91 L267.13,557.84 L270.35,559.91 L269.84,562.08 L269.79,561.33 L269.23,561.49 L269.43,563.14 L269.84,562.47 L269.63,563.75 Z", "M306.74,576.02 L305.85,573.65 L305.09,573.62 L305.17,572.19 L304.46,571.71 L305.43,570.98 L305.61,567.62 L307.02,570.53 L308.63,570.99 L308.81,571.75 L306.74,576.02 Z", "M305.04,566.86 L303.22,566.76 L302.45,565.19 L302.75,563.61 L304.68,560.88 L305.53,562.31 L304.48,565.58 L305.04,566.86 Z", "M300.10,510.01 L299.77,509.39 L297.54,509.37 L297.66,507.71 L298.28,507.32 L299.72,508.03 L300.10,510.01 Z"] },
  { code: "44208", name: "竹田市", color: "#122818", stroke: "#00c098", paths: ["M462.10,315.59 L457.11,319.04 L456.42,323.38 L452.08,327.47 L443.35,328.07 L446.90,327.30 L449.36,323.12 L447.43,312.69 L443.52,309.83 L439.78,311.12 L437.59,307.23 L434.41,306.94 L428.41,284.29 L424.86,279.13 L419.81,279.42 L420.65,273.70 L416.78,273.86 L414.72,277.26 L413.07,273.33 L410.55,274.11 L411.45,271.11 L408.40,267.24 L409.63,262.43 L405.21,261.80 L408.21,255.36 L406.67,254.17 L399.89,252.41 L398.35,256.17 L392.24,256.54 L382.89,263.61 L374.38,260.01 L372.91,256.54 L368.24,256.78 L366.88,253.74 L362.41,254.46 L355.81,238.84 L350.03,236.68 L351.07,234.03 L348.71,231.33 L350.54,229.17 L342.53,226.47 L339.60,219.70 L332.68,219.35 L323.33,214.12 L319.49,203.58 L313.04,204.48 L308.40,188.32 L311.99,174.33 L310.51,171.91 L315.36,170.78 L318.92,165.11 L332.01,165.29 L341.16,158.53 L347.79,158.16 L354.50,154.08 L360.17,157.74 L361.48,152.77 L367.83,152.62 L374.65,154.43 L388.75,163.43 L398.85,165.46 L400.48,170.82 L405.57,170.45 L405.47,174.29 L409.57,172.54 L410.94,175.07 L408.51,178.24 L412.94,185.90 L421.18,180.80 L428.20,185.47 L446.29,182.30 L446.46,184.24 L467.51,191.73 L475.41,189.01 L487.12,189.60 L490.81,198.83 L481.56,207.15 L480.83,213.00 L487.52,227.98 L493.31,231.46 L492.43,235.89 L489.89,240.48 L483.29,242.37 L481.73,248.02 L467.84,251.28 L463.75,262.71 L460.57,262.17 L456.41,270.02 L457.52,274.30 L463.20,274.92 L461.19,278.39 L463.94,279.62 L461.75,281.77 L463.04,283.38 L460.53,284.76 L467.08,292.23 L467.06,299.32 L469.56,302.83 L462.10,315.59 Z"] },
  { code: "44209", name: "豊後高田市", color: "#102420", stroke: "#00c8b0", paths: ["M713.55,544.74 L706.34,546.90 L707.14,549.52 L703.75,551.71 L696.89,550.36 L689.10,546.07 L682.71,545.93 L682.28,544.14 L676.76,542.88 L673.67,539.56 L669.41,541.80 L667.04,541.39 L662.82,544.97 L660.31,544.89 L656.84,538.70 L651.19,536.06 L648.56,536.87 L643.85,535.03 L641.69,537.35 L641.94,539.47 L638.12,541.12 L635.86,540.26 L631.33,536.72 L628.11,531.39 L630.30,524.40 L626.60,507.72 L617.01,496.05 L618.32,495.83 L614.72,489.29 L614.53,485.72 L612.26,483.49 L610.74,484.33 L600.25,478.81 L602.67,475.75 L602.82,472.74 L608.22,470.51 L610.21,467.05 L613.56,468.17 L622.33,463.93 L623.75,461.39 L627.63,462.17 L632.50,460.87 L639.53,455.18 L654.79,457.57 L662.21,456.44 L661.51,454.43 L664.08,450.74 L667.87,452.03 L668.83,454.20 L671.68,453.24 L670.19,452.34 L670.85,451.10 L673.63,451.98 L676.39,450.65 L680.63,455.70 L678.72,466.14 L686.15,464.74 L695.02,469.51 L688.14,465.32 L681.83,465.68 L687.86,465.77 L693.79,469.30 L696.62,495.24 L691.94,495.89 L692.98,496.54 L691.99,496.94 L696.10,496.24 L693.25,496.63 L693.19,499.11 L698.96,504.85 L699.15,507.22 L700.99,506.51 L698.52,507.48 L701.10,506.80 L699.05,507.70 L699.70,511.14 L702.07,509.49 L703.03,514.31 L705.17,515.26 L700.29,518.00 L700.37,520.08 L702.69,521.26 L704.36,520.29 L703.11,521.61 L704.77,520.38 L705.87,521.96 L704.11,527.03 L706.39,525.49 L705.31,527.00 L710.29,525.94 L713.39,529.85 L711.00,532.68 L713.33,534.12 L707.56,536.74 L707.26,538.97 L709.53,540.98 L707.43,542.20 L708.94,542.65 L706.47,541.82 L705.87,543.53 L712.67,543.51 L713.55,544.74 Z"] },
  { code: "44210", name: "杵築市", color: "#0e2018", stroke: "#00c0a8", paths: ["M627.95,530.38 L616.49,520.80 L600.96,518.80 L597.14,515.72 L595.65,517.57 L575.60,509.01 L567.56,516.18 L560.05,515.87 L554.38,525.75 L546.62,516.36 L544.26,516.79 L536.93,530.57 L539.86,535.05 L538.14,546.04 L532.06,550.02 L527.97,541.74 L514.92,528.99 L516.48,523.68 L524.41,518.87 L528.10,511.15 L526.56,514.99 L528.81,519.51 L536.75,514.18 L538.12,508.60 L533.53,508.88 L535.99,509.57 L543.58,503.92 L543.26,500.26 L541.25,503.08 L539.23,501.66 L538.85,496.68 L532.85,502.43 L535.10,498.76 L532.62,500.86 L531.64,498.50 L531.61,502.17 L530.99,499.22 L528.96,499.34 L530.15,496.46 L524.07,498.94 L518.00,497.62 L515.05,491.51 L520.81,482.29 L520.76,478.63 L528.91,482.90 L532.52,482.36 L533.89,478.83 L542.22,474.15 L541.04,468.49 L544.32,461.75 L547.73,466.02 L551.73,461.72 L556.09,466.07 L559.83,466.05 L559.08,470.37 L568.73,470.06 L570.37,467.25 L567.14,462.47 L565.52,448.00 L560.77,446.61 L564.29,441.02 L560.70,438.94 L568.05,427.48 L566.64,422.91 L579.29,413.06 L573.21,408.26 L574.24,406.46 L569.52,407.13 L565.11,391.59 L576.68,394.03 L583.13,387.31 L586.18,388.06 L593.50,397.53 L593.43,401.57 L600.48,404.59 L599.60,408.59 L607.05,415.57 L607.71,419.27 L615.72,420.62 L629.83,427.81 L635.38,424.83 L644.27,425.54 L647.78,439.59 L639.67,443.32 L645.34,447.22 L648.91,443.06 L649.84,446.49 L654.41,441.85 L651.90,457.52 L639.57,455.18 L632.50,460.87 L623.75,461.39 L613.56,468.17 L609.56,467.40 L608.22,470.51 L602.86,472.69 L600.25,478.81 L614.53,485.72 L617.01,496.05 L626.60,507.72 L630.30,524.40 L627.95,530.38 Z"] },
  { code: "44211", name: "宇佐市", color: "#102618", stroke: "#00c8a8", paths: ["M717.73,420.89 L713.04,425.58 L710.75,424.41 L711.61,426.85 L710.57,424.13 L706.07,424.84 L703.47,438.13 L699.43,440.40 L702.35,442.39 L698.04,443.46 L690.46,451.94 L689.83,453.78 L692.89,454.64 L687.83,454.37 L686.72,457.63 L690.76,458.05 L686.68,457.71 L684.56,460.86 L681.78,459.80 L679.06,462.60 L680.60,455.58 L676.39,450.65 L670.85,451.10 L671.68,453.24 L668.83,454.20 L664.08,450.74 L662.21,456.44 L651.90,457.52 L654.39,441.83 L649.84,446.49 L648.91,443.06 L645.34,447.22 L639.65,443.25 L647.78,439.59 L644.33,425.58 L635.38,424.83 L629.83,427.81 L615.72,420.62 L607.94,419.44 L607.05,415.57 L599.60,408.59 L600.48,404.59 L593.43,401.57 L593.50,397.53 L586.18,388.06 L583.13,387.31 L576.68,394.03 L566.28,392.13 L566.91,381.21 L571.56,375.46 L559.14,366.11 L566.21,355.30 L563.14,351.93 L565.54,345.13 L563.98,340.09 L566.89,340.47 L582.63,326.96 L592.94,327.65 L599.20,315.55 L609.84,316.39 L621.04,312.79 L623.91,309.30 L621.55,306.51 L623.70,302.42 L628.05,301.94 L631.00,297.30 L635.67,310.34 L642.58,308.32 L648.25,317.53 L653.78,317.99 L654.52,321.81 L651.54,323.42 L650.11,328.08 L646.87,329.06 L647.31,332.98 L655.84,337.67 L667.73,339.09 L671.79,343.58 L678.06,343.64 L681.77,348.10 L684.84,347.98 L681.48,357.66 L687.40,370.09 L712.15,373.18 L718.85,380.69 L720.05,383.63 L716.60,389.21 L729.07,400.78 L724.69,405.46 L723.72,411.30 L717.73,420.89 Z"] },
  { code: "44212", name: "豊後大野市", color: "#0e2018", stroke: "#00c0a0", paths: ["M404.27,363.49 L399.08,363.24 L396.44,367.31 L388.49,367.85 L384.05,371.40 L384.77,375.68 L381.29,381.14 L363.17,391.47 L359.69,391.05 L357.04,395.73 L358.78,402.30 L352.34,408.21 L353.06,397.24 L348.93,393.60 L350.00,390.95 L345.29,387.25 L345.38,384.42 L337.02,386.74 L331.61,382.01 L331.89,374.51 L336.87,370.33 L327.34,363.06 L328.15,360.80 L324.09,362.35 L322.26,359.63 L317.09,363.16 L306.14,360.53 L301.02,361.60 L290.93,357.14 L291.59,349.15 L285.84,339.83 L289.13,336.59 L288.05,330.52 L284.43,326.59 L280.92,330.88 L277.37,327.80 L278.08,325.07 L283.83,324.53 L285.05,320.37 L277.47,317.30 L276.83,313.79 L272.01,309.72 L272.31,303.39 L274.65,301.82 L268.14,297.61 L278.42,285.96 L274.76,259.50 L280.20,244.75 L277.50,235.44 L278.32,225.02 L284.98,211.99 L281.18,205.93 L280.66,199.25 L287.53,190.49 L292.03,172.07 L295.14,168.39 L300.90,166.66 L311.71,172.72 L308.36,187.52 L309.16,196.21 L313.04,204.48 L319.49,203.58 L323.33,214.12 L332.68,219.35 L339.60,219.70 L342.53,226.47 L350.54,229.17 L348.71,231.33 L351.07,234.03 L350.03,236.68 L355.81,238.84 L362.41,254.46 L366.88,253.74 L368.24,256.78 L372.91,256.54 L374.38,260.01 L382.89,263.61 L392.24,256.54 L398.35,256.17 L399.89,252.41 L406.67,254.17 L408.21,255.36 L405.21,261.80 L409.63,262.43 L408.40,267.24 L411.45,271.11 L410.60,274.19 L413.07,273.33 L414.72,277.26 L416.78,273.86 L420.65,273.70 L419.81,279.42 L424.86,279.13 L428.41,284.29 L429.82,294.56 L427.36,295.03 L423.74,291.29 L421.58,292.37 L421.35,302.91 L423.35,306.29 L421.70,312.69 L409.95,306.89 L402.18,311.89 L401.64,316.63 L404.46,318.41 L400.94,317.84 L399.46,323.36 L403.02,329.60 L407.43,329.05 L408.95,336.25 L405.69,343.78 L405.24,354.62 L407.29,358.01 L405.64,364.69 L404.27,363.49 Z"] },
  { code: "44213", name: "由布市", color: "#0c2014", stroke: "#00ba98", paths: ["M564.57,359.46 L559.14,366.11 L552.23,369.48 L551.30,378.98 L548.43,381.08 L546.29,379.90 L540.84,367.23 L534.60,363.71 L534.30,354.15 L537.70,346.82 L528.20,342.67 L523.72,330.18 L515.15,326.61 L505.46,334.29 L502.96,351.95 L501.82,354.22 L497.64,353.56 L496.22,358.32 L498.68,359.12 L498.51,363.73 L485.69,366.96 L482.19,369.56 L481.79,374.53 L475.19,377.74 L482.01,383.52 L489.59,386.21 L483.18,394.92 L478.87,395.67 L474.43,400.91 L470.06,399.45 L472.32,396.93 L465.57,392.82 L462.95,387.82 L458.78,388.24 L457.08,383.59 L452.82,383.44 L453.45,381.22 L450.84,380.06 L453.30,372.93 L445.07,357.29 L449.83,353.32 L445.61,349.46 L446.65,340.01 L444.58,334.16 L447.22,331.78 L443.32,328.15 L451.94,327.54 L456.42,323.38 L455.52,321.00 L463.14,315.09 L469.53,303.06 L467.06,299.32 L467.08,292.23 L460.53,284.76 L463.04,283.38 L461.75,281.77 L463.94,279.62 L461.19,278.39 L463.20,274.92 L457.52,274.30 L456.34,270.48 L460.57,262.17 L463.75,262.71 L467.84,251.28 L481.73,248.02 L483.29,242.37 L489.89,240.48 L493.58,233.66 L499.04,237.57 L501.27,250.65 L500.93,263.06 L497.72,267.44 L499.58,280.87 L504.21,279.46 L503.89,273.12 L511.79,270.03 L507.49,278.11 L510.54,276.46 L512.00,278.71 L515.71,277.75 L521.26,273.22 L546.61,276.35 L548.82,293.79 L555.79,301.02 L560.66,325.74 L572.61,322.85 L571.18,327.25 L574.06,333.99 L563.72,340.79 L565.54,345.13 L563.14,351.93 L566.21,355.30 L564.57,359.46 Z"] },
  { code: "44214", name: "国東市", color: "#0e2220", stroke: "#00c2b0", paths: ["M700.02,575.17 L693.16,577.88 L690.69,582.93 L686.39,579.96 L681.86,582.68 L684.01,586.21 L679.13,586.16 L677.49,588.66 L681.57,591.46 L679.93,593.98 L676.09,593.42 L674.94,595.57 L673.05,593.73 L672.38,596.91 L669.47,597.22 L670.96,596.62 L669.08,593.28 L664.04,593.44 L666.42,601.05 L664.13,602.39 L659.48,599.85 L647.21,600.00 L643.61,600.57 L643.23,604.20 L641.18,604.72 L621.50,598.73 L617.40,599.69 L615.21,603.74 L616.36,601.89 L614.80,603.65 L614.28,601.78 L605.95,601.35 L599.18,603.07 L590.67,597.91 L591.50,601.62 L588.79,597.78 L589.15,600.01 L586.44,599.54 L577.85,593.68 L574.63,594.26 L572.42,591.12 L573.77,589.61 L560.13,575.57 L556.10,574.14 L557.15,572.81 L549.38,569.88 L551.89,572.87 L550.61,574.78 L535.80,565.56 L536.55,562.78 L539.76,564.43 L539.12,559.26 L537.52,561.54 L537.18,556.90 L531.30,550.70 L538.14,546.04 L539.86,535.05 L536.93,530.57 L544.26,516.79 L546.62,516.36 L554.38,525.75 L560.05,515.87 L567.56,516.18 L575.70,508.99 L595.65,517.57 L597.14,515.72 L600.96,518.80 L616.49,520.80 L638.12,541.12 L641.96,539.45 L643.85,535.03 L656.77,538.66 L660.31,544.89 L673.67,539.56 L682.71,545.93 L689.10,546.07 L703.75,551.71 L704.22,562.07 L697.98,562.66 L696.09,560.49 L693.63,564.67 L700.38,567.83 L700.02,575.17 Z"] },
  { code: "44322", name: "姫島村", color: "#081828", stroke: "#00accc", paths: ["M699.75,629.17 L697.65,630.75 L695.86,634.40 L696.36,632.94 L695.46,632.91 L695.65,633.93 L695.32,632.97 L693.05,633.34 L690.42,636.20 L690.57,638.34 L686.56,639.52 L689.04,637.33 L688.28,635.50 L688.86,636.72 L689.32,635.59 L689.60,636.32 L690.49,635.48 L688.79,635.50 L690.99,635.22 L690.28,631.50 L691.37,626.42 L690.00,625.17 L690.26,624.36 L689.84,625.59 L689.53,619.67 L693.04,616.51 L693.31,617.32 L694.53,617.03 L695.74,613.34 L696.40,615.23 L696.61,613.29 L695.58,612.13 L696.73,613.07 L696.76,614.52 L697.99,612.02 L696.65,612.33 L698.18,610.78 L695.89,611.37 L698.17,610.73 L698.53,607.88 L697.91,607.87 L699.14,604.58 L700.66,604.26 L702.17,606.59 L701.35,609.84 L703.13,611.55 L701.35,610.65 L704.99,614.40 L703.51,615.60 L702.62,614.77 L702.27,616.53 L702.38,615.45 L701.21,615.20 L701.91,616.24 L699.96,618.83 L701.16,619.60 L700.50,621.06 L701.69,627.74 L699.75,629.17 Z"] },
  { code: "44341", name: "日出町", color: "#0c1c14", stroke: "#00bc98", paths: ["M568.73,470.06 L559.08,470.37 L560.45,468.60 L559.83,466.05 L556.09,466.07 L551.73,461.72 L547.73,466.02 L544.32,461.75 L541.04,468.49 L542.15,474.27 L533.89,478.83 L532.52,482.36 L528.91,482.90 L521.13,478.82 L523.09,472.71 L523.96,473.34 L526.57,469.68 L522.73,466.42 L519.66,466.45 L515.15,462.27 L514.93,460.01 L515.73,457.49 L515.56,458.61 L521.26,457.56 L521.28,456.03 L520.80,457.08 L515.77,456.30 L525.85,448.24 L526.88,445.52 L528.73,445.30 L526.57,444.90 L528.82,441.48 L533.14,440.21 L540.09,441.92 L545.56,436.15 L546.72,426.54 L548.89,422.42 L547.28,422.45 L547.45,421.22 L547.06,422.29 L542.21,416.50 L544.32,418.09 L545.35,415.56 L548.91,413.48 L548.26,410.05 L549.23,412.34 L553.65,408.14 L556.25,396.70 L559.46,393.35 L559.63,391.70 L557.70,391.82 L558.77,387.30 L559.32,388.72 L561.53,382.72 L564.75,380.90 L567.45,383.93 L566.28,392.13 L565.09,391.86 L569.52,407.13 L574.24,406.46 L572.81,406.78 L573.21,408.26 L579.29,413.13 L571.53,417.79 L569.54,421.87 L566.64,422.91 L568.05,427.48 L560.70,438.94 L564.37,441.30 L560.77,446.61 L565.52,448.00 L565.90,453.73 L567.61,455.87 L567.22,462.74 L570.67,465.17 L568.73,470.06 Z"] },
  { code: "44461", name: "九重町", color: "#122618", stroke: "#00be88", paths: ["M590.28,290.99 L577.17,289.93 L572.91,285.69 L569.68,287.45 L568.71,292.19 L563.05,287.99 L557.95,294.84 L549.03,294.04 L546.61,276.35 L521.26,273.22 L515.71,277.75 L512.00,278.71 L510.54,276.46 L507.49,278.11 L511.79,270.03 L503.89,273.12 L504.21,279.46 L499.58,280.87 L497.72,267.44 L500.19,265.83 L501.78,257.27 L499.08,237.69 L487.52,227.98 L480.83,213.00 L481.56,207.15 L490.81,198.83 L485.91,186.77 L487.14,185.14 L497.14,183.73 L507.28,190.11 L516.21,189.87 L521.74,195.56 L527.74,197.05 L539.59,193.53 L541.16,196.15 L556.73,188.41 L567.75,190.51 L584.55,213.94 L585.61,222.47 L590.99,226.69 L591.82,232.67 L588.48,239.48 L597.20,247.19 L593.89,249.49 L592.85,254.08 L596.29,257.83 L592.88,264.03 L595.08,268.61 L597.90,269.12 L596.15,270.35 L597.53,274.84 L592.59,282.67 L592.01,291.44 L590.28,290.99 Z"] },
  { code: "44462", name: "玖珠町", color: "#102418", stroke: "#00bc90", paths: ["M678.93,254.80 L666.59,259.13 L664.46,256.86 L659.81,260.86 L664.17,268.44 L660.20,272.36 L649.82,271.47 L649.30,278.99 L637.65,278.28 L635.78,284.06 L629.60,284.44 L632.37,295.08 L628.10,301.91 L623.70,302.42 L621.55,306.51 L623.91,309.30 L621.04,312.79 L609.84,316.39 L599.20,315.55 L592.94,327.65 L582.63,326.96 L574.06,333.99 L571.18,327.25 L572.60,322.84 L560.66,325.74 L555.79,301.02 L549.03,294.04 L557.95,294.84 L563.05,287.99 L568.71,292.19 L569.68,287.45 L572.91,285.69 L577.17,289.93 L591.74,291.78 L592.59,282.67 L597.53,274.84 L596.15,270.35 L597.90,269.12 L595.08,268.61 L592.88,264.03 L596.29,257.83 L592.85,254.08 L593.89,249.49 L597.20,247.19 L588.44,239.42 L591.82,232.67 L591.03,226.79 L585.61,222.47 L584.49,213.83 L566.70,189.63 L572.08,186.58 L572.31,183.11 L577.44,178.59 L590.21,190.75 L600.03,195.90 L601.38,199.22 L608.29,198.37 L612.46,195.13 L621.80,199.07 L625.14,194.73 L622.76,192.11 L625.64,190.32 L626.79,184.68 L629.81,186.31 L634.56,184.77 L633.47,189.83 L636.11,192.32 L637.54,190.18 L644.18,195.85 L647.52,208.46 L651.92,209.98 L655.18,218.77 L651.75,221.62 L653.55,222.74 L655.89,220.64 L659.55,224.80 L663.32,217.48 L672.54,228.66 L676.62,226.77 L681.56,232.19 L685.19,239.52 L678.93,254.80 Z"] },
];

const MUNICIPALITIES: { code: string; name: string; x: number; y: number }[] = [
  { code: "44201", name: "大分市", x: 382.6, y: 536.5 },
  { code: "44202", name: "別府市", x: 521.9, y: 386.2 },
  { code: "44203", name: "中津市", x: 711.9, y: 315.5 },
  { code: "44204", name: "日田市", x: 645.4, y: 143.5 },
  { code: "44205", name: "佐伯市", x: 173.9, y: 462.9 },
  { code: "44206", name: "臼杵市", x: 331.8, y: 478.2 },
  { code: "44207", name: "津久見市", x: 286.7, y: 514.5 },
  { code: "44208", name: "竹田市", x: 409.3, y: 236.3 },
  { code: "44209", name: "豊後高田市", x: 684.1, y: 514.6 },
  { code: "44210", name: "杵築市", x: 575.2, y: 479.7 },
  { code: "44211", name: "宇佐市", x: 665.2, y: 396.1 },
  { code: "44212", name: "豊後大野市", x: 349.6, y: 298.8 },
  { code: "44213", name: "由布市", x: 494.9, y: 325.6 },
  { code: "44214", name: "国東市", x: 621.4, y: 571.1 },
  { code: "44322", name: "姫島村", x: 696.7, y: 621.8 },
  { code: "44341", name: "日出町", x: 538.5, y: 444.4 },
  { code: "44461", name: "九重町", x: 546.1, y: 247.6 },
  { code: "44462", name: "玖珠町", x: 616.0, y: 255.3 },
];

// インシデント名 → 市区町村重心座標（GeoJSON投影ベース）
const INCIDENT_COORDS: Record<string, { x: number; y: number }> = {
  "大分港次元歪曲事案":   { x: 382.6, y: 536.5 },
  "別府湾不根侵入事案":   { x: 521.9, y: 386.2 },
  "由布岳時空歪曲":       { x: 494.9, y: 325.6 },
  "姫島沖境界ゲート":     { x: 696.7, y: 621.8 },
  "中津市内認識異常":     { x: 711.9, y: 315.5 },
  "佐伯湾残滓回収作業":   { x: 173.9, y: 462.9 },
  "日田市郊外漂流者発見": { x: 645.4, y: 143.5 },
  "豊後水道次元境界監視": { x: 286.7, y: 514.5 },
  "国東半島空間歪み":     { x: 621.4, y: 571.1 },
  "豊後高田海域不根商人": { x: 684.1, y: 514.6 },
};

const SEV = {
  critical: { color: "#ef4444", bg: "rgba(239,68,68,0.15)",  label: "重大" },
  warning:  { color: "#eab308", bg: "rgba(234,179,8,0.15)",  label: "警戒" },
  safe:     { color: "#10b981", bg: "rgba(16,185,129,0.15)", label: "安全" },
} as const;

const W = 860, H = 680;

export default async function MapPage() {
  const h = await headers();
  const lvl = parseInt(h.get("x-user-level") ?? "0");
  if (lvl < 1) return <LockedContent requiredLevel={1} currentLevel={lvl} pageName="インシデントマップ" />;

  const { incidents, statistics } = await loadMapData();

  const incWithPos = incidents.map(inc => ({
    ...inc,
    pos: INCIDENT_COORDS[inc.name] ?? {
      x: 40 + (inc.position.x / 100) * (W - 80),
      y: 40 + (inc.position.y / 100) * (H - 80),
    },
  }));

  return (
    <div className="animate-fadeIn" style={{ padding: "2.5rem 1.5rem", maxWidth: "1400px", margin: "0 auto" }}>
      <div style={{ borderLeft: "4px solid var(--primary)", paddingLeft: "1rem", marginBottom: "1.5rem" }}>
        <div className="font-mono" style={{ fontSize: "0.72rem", color: "var(--primary)", letterSpacing: "0.15em", marginBottom: "0.4rem" }}>
          INCIDENT MAP // REAL-TIME MONITORING
        </div>
        <h1 style={{ fontSize: "2rem", fontFamily: "'Space Grotesk', sans-serif", fontWeight: 700, color: "white" }}>
          インシデントマップ
        </h1>
        <p className="font-mono" style={{ fontSize: "0.8rem", color: "var(--muted-foreground)", marginTop: "0.25rem" }}>
          大分県 — リアルタイム監視 // N03-20250101_44.geojson · 123°回転投影
        </p>
      </div>

      <div style={{ display: "grid", gridTemplateColumns: "repeat(4,1fr)", gap: "0.75rem", marginBottom: "1.5rem" }}>
        {([
          { label: "総インシデント", value: statistics.total,    color: "var(--primary)" },
          { label: "重大",           value: statistics.critical, color: "#ef4444" },
          { label: "警戒",           value: statistics.warning,  color: "#eab308" },
          { label: "安全",           value: statistics.safe,     color: "#10b981" },
        ] as { label: string; value: number; color: string }[]).map(s => (
          <div key={s.label} className="card" style={{ padding: "0.875rem", textAlign: "center" }}>
            <div style={{ fontSize: "1.5rem", fontFamily: "'JetBrains Mono',monospace", fontWeight: 700, color: s.color }}>{s.value}</div>
            <div className="font-mono" style={{ fontSize: "0.65rem", color: "var(--muted-foreground)", marginTop: "0.2rem" }}>{s.label}</div>
          </div>
        ))}
      </div>

      <div style={{ display: "grid", gridTemplateColumns: "1fr 360px", gap: "1.25rem" }}>
        <div className="card" style={{ padding: 0, overflow: "hidden" }}>
          {/* ── マップヘッダー ── */}
          <div style={{
            padding: "0.65rem 1rem", borderBottom: "1px solid rgba(255,255,255,0.06)",
            display: "flex", alignItems: "center", justifyContent: "space-between",
          }}>
            <div style={{ display: "flex", alignItems: "center", gap: "1rem" }}>
              <span className="font-mono" style={{ fontSize: "0.65rem", color: "var(--primary)", letterSpacing: "0.1em" }}>▸ OITA PREF. MAP — GeoJSON</span>
              <div style={{ display: "flex", gap: "0.75rem" }}>
                {(["critical","warning","safe"] as const).map(k => (
                  <span key={k} className="font-mono" style={{ fontSize: "0.6rem", color: SEV[k].color, display: "flex", alignItems: "center", gap: "0.3rem" }}>
                    <span style={{ display:"inline-block", width:"7px", height:"7px", borderRadius:"50%", backgroundColor: SEV[k].color }} />
                    {SEV[k].label}
                  </span>
                ))}
              </div>
            </div>
            <span className="font-mono" style={{ fontSize: "0.58rem", color: "rgba(0,255,255,0.3)" }}>ROT 123° · KM PROJ · N03-2025</span>
          </div>

          {/* ── SVG マップ本体（インタラクティブ） ── */}
          <InteractiveMap
            geoPaths={GEO_PATHS}
            municipalities={MUNICIPALITIES}
            incidents={incWithPos}
            W={W}
            H={H}
          />
        </div>

        {/* ── サイドパネル: インシデントリスト ── */}
        <div style={{ display: "flex", flexDirection: "column", gap: "0.625rem", overflowY: "auto", maxHeight: "740px" }}>
          <div className="font-mono" style={{ fontSize: "0.65rem", color: "var(--muted-foreground)", letterSpacing: "0.1em", marginBottom: "0.25rem" }}>
            ACTIVE INCIDENTS ({incidents.length})
          </div>
          {incidents.map(inc => {
            const s = SEV[inc.severity] ?? SEV.safe;
            return (
              <div key={inc.id} className="card" style={{ borderColor: `${s.color}30`, padding: "0.875rem" }}>
                <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: "0.5rem" }}>
                  <div style={{ fontFamily: "'Space Grotesk',sans-serif", fontWeight: 600, fontSize: "0.875rem", color: "white", lineHeight: 1.3 }}>
                    {inc.name}
                  </div>
                  <span style={{
                    fontSize: "0.6rem", padding: "0.15rem 0.45rem",
                    fontFamily: "'JetBrains Mono',monospace", fontWeight: 700,
                    flexShrink: 0, marginLeft: "0.5rem",
                    backgroundColor: s.bg, color: s.color,
                  }}>{s.label}</span>
                </div>
                <p style={{ fontSize: "0.72rem", color: "var(--muted-foreground)", lineHeight: 1.5, marginBottom: "0.5rem" }}>
                  {inc.description}
                </p>
                <div style={{ display: "flex", flexDirection: "column", gap: "0.2rem" }}>
                  {([
                    { k: "場所", v: inc.location },
                    { k: "状態", v: inc.status,          hl: true },
                    { k: "GSI",  v: inc.gsi,              ac: "var(--primary)" },
                    { k: "担当", v: inc.assignedDivision },
                  ] as { k: string; v: string; hl?: boolean; ac?: string }[]).map(item => (
                    <div key={item.k} style={{ display: "flex", gap: "0.5rem", alignItems: "baseline" }}>
                      <span className="font-mono" style={{ fontSize: "0.58rem", color: "var(--muted-foreground)", minWidth: "2.5rem" }}>{item.k}</span>
                      <span className="font-mono" style={{ fontSize: "0.68rem", color: item.ac ?? (item.hl ? s.color : "rgba(255,255,255,0.7)") }}>
                        {item.v}
                      </span>
                    </div>
                  ))}
                </div>
                <div className="font-mono" style={{ fontSize: "0.58rem", color: "rgba(255,255,255,0.2)", marginTop: "0.5rem", textAlign: "right" }}>
                  {inc.timestamp}
                </div>
              </div>
            );
          }))}
        </div>
      </div>
    </div>
  );
}
